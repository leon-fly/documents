---
date: "2018-01-01"
draft: false
lastmod: "2018-01-01"
publishdate: "2018-01-01"
tags:
- db
- mysql
title: mysql索引
---

## 1. mysql支持的索引
* B树索引
* hash索引
* 空间数据索引
* 全文索引

不同的存储引擎支持的索引类型不同，只有Memory引擎显式支持哈希索引。不同的存储引擎对于同类型的索引实现可能不同。

## 2. 索引类型详细说明
### 2.1. B树索引
合理使用B树索引，可以提升查询及排序性能，B树本事为支持有序遍历的数据结构。
#### 2.1.1. 索引结构
B树索引在InnoDB的实现为B+树
TODO
#### 2.1.2. B树适用的查询类型
B树索引适用于全键值、键值范围和键前缀查找。其中键前缀查找只适用于根据最左前缀查找。
* 全值匹配
全值匹配即对索引中所有列进行匹配。如有索引index(last_name,first_name),那么全值匹配即为where last_name='xxx' and 'first_name'='xxx'

* 匹配最左前缀
使用索引的前N个列进行匹配。

* 匹配列前缀
匹配某一列的值的开头部分。

* 匹配范围值
* 精确匹配某一列并范围匹配另外一列
* 只访问索引的查询
B树索引通常可以支持值访问索引的查询，即查询只需要访问索引，无需访问数据行。

#### 2.1.3. B树索引有效性限制
* 如果不是按照索引的最左列开始查找则无法使用索引。
* 不能跳过（组合）索引中的列直接通过后面的列查找
* 如果查询中有某个列的范围查询，则其右边的列都无法使用索引优化查找。
比如有索引index(a,b,c)，如果查询where a='xxx' and b<'yyy' and c='zzz' 那么第三格条件c无法使用索引。

### 2.2. 哈希索引
哈希索引基于哈希表实现，只有精确匹配索引所有列的查询才有效，不支持范围查询。
mysql引擎对每一行数据的索引列进行hash作为键，值保存的是指向每个数据行的指针。


## 3. 索引的优点
* 大大减小了服务器需要扫描的数据量
* 帮助服务器避免排序和临时表
* 可以将I/O变为顺序I/O

## 4. 高性能索引策略
### 独立的列
索引列不能是表达式的一部分，也不能是函数的一部分，否则索引失效。
### 哈希索引模拟
通过对需要索引的长列A创建其对应哈希值的列A‘，从而对该列创建索引转而对A’创建索引。通过该方法解决存储引擎不支持哈希索引或索引列的长度过长导致性能不佳的方案
### 前缀索引和索引的选择性
前缀索引是仅仅通过索引数据列值的**前n个字符**以解决的是当索引列过长导致索引效率降低的问题。
**----那么n如何定？----**
解决索引过长的问题我们希望n越小越好，但是n过小可能导致重复索引数据过多，索引同样低效，所以我们需要一个平衡点。
**----索引的选择性-----**
索引的选择性即不重复的索引值与数据表的总记录的比值。索引的选择性越高查询效率越高。

**----找出最佳n----**
从n=3开始获取该值下重复的索引数以及不重复的索引值与数据表的总记录的比值


待续...