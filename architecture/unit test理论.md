---
date: "2022-02-01"
draft: false
lastmod: "2022-02-01"
publishdate: "2022-02-01"
tags:
- architecture
- unit test
title: unit test理论
---

# unit test
## 1.好的单元测试应该具备什么特性
单元测试主要针对控制流代码。包括if,case已经其他决策类型的代码。单元测试一定要区别于集成测试。优秀的单元测试要考虑具备如下特性：

*  自动化，可重复性(比如测试前的数据准备，测试后的数据清理)
*  容易实现
*  第二天还有意义（比如计算生日的方法测试，单元测试中给的当前时间应该是固定的，而不能用运行时的时间）
*  任何人都能一键运行
* 高效运行（确保打包前的所有的单元测试不会花过多的时间去执行）
* 测试结果是稳定的（如果运行之前没有进行修改，多次运行一个测试应该总是返回同样的结果）
* 良好的隔离性（独立于其他的单元测试）
* 覆盖代码的所有重要部分（不论逻辑简单与否，当不包含任何逻辑判断的代码不必要要单元测试，因为是测试的覆盖之内，必然会执行到的逻辑）
* 良好的可读性（如测试的是什么方法，期待有什么样的结果）

**关联注意：**

编写可测试化的代码：

1. 面向接口编程
2. 方法抽象

## 2. 单元测试的基本规范
* 单元测试类命名规范

  要测试的类的类名+Test，如测试BusinessServiceImpl，则测试类名可定义为BusinessServiceImplTest

* 单元测试方法命名规范

  方法命名力争体现测试的方法，测试条件及预期结果，不用太过考虑方法是否太长。示例：

  目标测试方法: saveUser, 测试条件：用户存在  测试结果：保存方法不调用，则测试方法可命名为：

  > testSaveUser_when_userExisted_then_notSave

  用"_"将各个条件划分开来

* 单元测试内容如包含多个测试阶段，为了更好的阅读可以在各个阶段后加空行

## 3. 单元测试中的一些核心概念

* Test Double 一个“替身”的通用名次. 这个名字源于一部电影中Stunt Double (用这个名字替代被广为使用的名字)
  * Dummy  被传递但是从来没被使用，一般知识用来填充参数。
  * Fake 对象实际上有具体实现，但通常采用一些简单方式，不适合生产（比如使用内存型数据库作为单元测试的库）
  * Stubs 为测试期间的请求提供固定的应答
  * Spies 也是一种的stubs, 会基于调用记录一些信息。Mock框架中Spy调用的是实际目标方法。
  * **Mocks.** 使用期望对对象进行预编程，可以针对不同的请求可以有不同的反馈，还可以进行行为验证。

## 4. 参考

* Book - The art of Unit Testing - Roy Osherove (单元测试的艺术)

* [martingfowler - mocks are't stubs](https://martinfowler.com/articles/mocksArentStubs.html)







