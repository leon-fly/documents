---
date: "2018-01-01"
draft: false
lastmod: "2018-01-01"
publishdate: "2018-01-01"
tags:
- project
title: Jinju自营平台
---
# 1. 项目后端架构
* 整体采用基于spring boot微服务架构，接口为restful规范。
* 核心微服务模块
    * 保单微服务微服务模块
    * 产品微服务模块
    * 支付微服务模块
    * 费率计算微服务模块
    * 微信处理微服务模块
    * 财务微服务模块
    * 保司微服务模块
    * 渠道微服务模块
    * 营销活动模块
    * API模块
# 2. 关键设计
## 2.1. 接口数据安全处理
基于SpringSecurity实现，根据请求头信息满足合作方选择性对请求加解密。
* 创建两个Filter,一个Filter用于将ServletRequest替换为可多次读的ServletRequest，并放入FilterChain中，另一个用于对请求进行AES加解密。
* 实现HttpServletRequestWrapper和HttpServletResponseWrapper，一个用于对请求进行解密后的封装，一个用于对返回进行加密后封装。
## 2.2. 日志脱敏组件
* 基于注解进行脱敏，创建脱敏的方法（脱敏时一层层解析，要注意循环引用二次脱敏）。
* 创建脱敏关键字池（关键字有对应的敏感数据类型），对json、xml格式解析为数据片段，对片段匹配关键字进行脱敏。
* 脱敏基础：敏感数据类型及对应脱敏规则
## 2.3. 营销活动模块（基于抽奖必中）
* 功能：
    * 能够记录营销活动信息，某次营销活动的抽奖人数，领奖品人数
    * 支持抽取不同奖品领取（保险、电子券、实物）
    * 支持每个产品总量限制和当天发放量限制
    * 支持不同的抽奖算法：
        * 无份数限制基于概率
        * 基于份数。
* 使用策略模式和模版方法（模版中实现抽奖通用逻辑，比如活动奖品查询，可发放奖品数校验）实现
* 关于抽奖并发问题
    * 如果无份数限制不考虑并发问题
    * 有份数限制时锁定活动奖品表记录（共享资源）
* 表设计
    * 活动表
    * 奖品表
    * 活动奖品表
    * 抽奖及领取记录表

## 2.4. RateTable

## 2.5. 数据接口BaseCommponet、BaseAttribute

# 3. 关键技术

## 3.1. spring boot

## 3.2. spring security

## 3.3. spring data jpa

## 3.4. spring security

## 3.5. apache camel

## 3.6. 内存型数据库hsqldb
[对比参考](https://blog.csdn.net/bcghgfr/article/details/83857285)
* 选型 hsqldb vs h2
    共同点：
    * 都是内存性数据库
    * 都支持进程内运行
    * 都基于jdbc访问
    * 都是纯java实现
    * 关系型数据库特性基本都相同，访问控制。
    * 数据列和表大小上各有千秋，列名大小hsqldb限制比较紧
    不同点
    * hsqldb 2001年第一个版本，版本迭代到2.0+，h22005年


## 3.7. 前端：vue

